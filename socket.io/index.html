<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Room</title>
        <style>  
            #chatdiv{
                width: 50vw;
                height: 100vh;
                
                background-image: url("https://www.popdaily.com.tw/shaper/wp-content/uploads/2021/06/6wpgbwnpqi8s0cc4kgks0wcs8qvfdwc-562x1000.jpg?resize-w=1300&resize-h=2301");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: top;   
                z-index: 50;

            }

            ul{
                width: 98%;
                
                padding:0;
                margin-top: 10px;
                
            }

            li{
                margin-top: 10px;
                padding: 10px;
                font-size: 20px;
                font-weight: bold;
                color:aqua;
                background-color: rgb(240, 148, 202);
            }
        </style>
<!-- 弹幕code------------------------------------------------------------------------->
        <title>Hello Page, Week1</title>
        <script type="text/javascript">
            
            window.addEventListener("load", init);
            
            function init() {
                let title = document.getElementById("title");
                let titleImage = document.getElementById("titleImage");

                title.addEventListener("mouseover", function() {
                    title.innerHTML = "CHAT!+LIVE!";
                    titleImage.style.display = "block"; // 显示图片
                });

                title.addEventListener("mouseout", function() {
                    title.innerHTML = "+HELLO WORLD+";
                    titleImage.style.display = "none"; // 隐藏图片
                });
                
            }
        </script>
        <style>
            #title {
                text-align: center;
            }
            body {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                margin: 0;
                background: #dcdedf;
            }
            
            .morph-section {
                width: 1000px; /* 增大宽度 */
                height: 1000px; /* 增大高度 */
                position: absolute;
                left: 50%; /* 左侧居中 */
                top: 50%; /* 垂直居中 */
                transform: translate(-70%, -26%); /* 调整居中 */
                font-family: monospace;
                color: #000000;
            }
            
            .info {
                font-family: monospace;
                position: absolute;
                line-height: 20px;
                font-size: 14px;
                left: 20px;
                bottom: 20px;
                color: #000000;
            }
            
            a {
                color: #000000;
            }
            #title {
                text-align: center;
                z-index: 1000;
                bottom: 45%; /* 距离底部的位置 */
                /* 文本输入框和按钮样式 */

            }
            #titleImage {
                display: none; /* 初始状态为隐藏 */
                width: 600px; /* 调整图片的宽度 */
                height: auto; /* 高度自动调整 */
                margin-left: 80px; /* 在图片和标题之间添加一些间距 */
                left: 40%; /* 左侧与标题的右侧对齐 */
                bottom: 55%; /* 距离底部的位置 */
            }
            #userInput, button {
                z-index: 1001;   /* 高z-index值确保元素在最上面 */
                bottom: 45%; /* 距离底部的位置 */
                /* 添加更多样式以美化这些元素 */  }

            /* 使文本输入框和按钮在页面中央下方显示 */
            #userInput {
                bottom: 30%; /* 距离底部的位置 */
                left: 40%;  /* 水平居中 */
                justify-content: center; /* 垂直居中 */
                transform: translateX(0%); /* 调整位置以确保居中 */
                z-index: 1001;
            }

            button {
                bottom: 25%; /* 距离底部的位置 */
                left: 53%;  /* 水平居中 */
                transform: translateX(8%); /* 调整位置以确保居中 */
                z-index: 1001;
            }

        </style>

    </head>
    <body>
        <ul id="messageList"></ul>
        <form action="">
            <input type="text" id="messageInput" placeholder="Type a message...">
            <button type="submit">Send</button>
            <div id="messages"></div>
            <div id="marqueeContainer"></div>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            const form = document.querySelector('form');
            const input = document.querySelector('input');
            const ul = document.querySelector('ul');

            form.addEventListener('submit', e => {
            e.preventDefault();
            const message = input.value.trim();
            createMarquee();
            if (message) {
                socket.emit('chat message', message); // 发送聊天消息
                input.value = ''; // 清空输入框


        }
            });
            socket.on('chat message', msg => {
                var ul = document.getElementById('messageList'); // 假设你的<ul>元素有一个ID
                var li = document.createElement('li');
                li.textContent = msg;
                ul.appendChild(li);
                createMarquee_para(li.textContent);
            });
        </script>
        </form>

<!-- 弹幕code------------------------------------------------------------------------->

        <h1 id="title">+HELLO WORLD+</h1>
        <img id="titleImage" src="chat-01.png" style="display: none; position: absolute; right: 50%;" />
        <p>

           </p>


        <pre class="morph-section">
        </pre>
        <script>
            /**Credits:
 * Ascii Morph
 * @author: Tim Holman (http://tholman.com)https://github.com/tholman/ascii-morph
 * part of code Assisted by chatgpt4
 */

var AsciiMorph = (function() {

'use strict';

var element = null;
var canvasDimensions = {};

var renderedData = [];
var framesToAnimate = [];
var myTimeout = null;

/**
 * Utils
 */

function extend(target, source) {
  for (var key in source) {
    if (!(key in target)) {
      target[key] = source[key];              
    }
  }
  return target;
}

function repeat(pattern, count) {
    if (count < 1) return '';
    var result = '';
    while (count > 1) {
        if (count & 1) result += pattern;
        count >>= 1, pattern += pattern;
    }
    return result + pattern;
}

function replaceAt(string, index, character ) {
  return string.substr(0, index) + character + string.substr(index+character.length);
}

/**
 * AsciiMorph
 */

function init(el, canvasSize) {
  
  // Save the element
  element = el;
  canvasDimensions = canvasSize;
}

function squareOutData(data) {
   var i;
  var renderDimensions = {
    x: 0,
    y: data.length
  };

  // Calculate centering numbers
  for( i = 0; i < data.length; i++ ) {
    if( data[i].length > renderDimensions.x) {
      renderDimensions.x = data[i].length
    }
  }
  
  // Pad out right side of data to square it out
  for( i = 0; i < data.length; i++ ) {
    if( data[i].length < renderDimensions.x) {
      data[i] = (data[i] + repeat(' ', renderDimensions.x - data[i].length ));
    }
  }
  
  var paddings = {
    x: Math.floor((canvasDimensions.x - renderDimensions.x) / 2),
    y: Math.floor((canvasDimensions.y - renderDimensions.y) / 2)
  }
  
  // Left Padding
  for( var i = 0; i < data.length; i++ ) {
    data[i] = repeat(' ', paddings.x) + data[i] + repeat(' ', paddings.x);
  }
  
  // Pad out the rest of everything
  for( var i = 0; i < canvasDimensions.y; i++ ) {
    if( i < paddings.y) {
      data.unshift( repeat(' ', canvasDimensions.x));
    } else if (i > (paddings.y + renderDimensions.y)) {
      data.push( repeat(' ', canvasDimensions.x));
    }
  }
  
  return data;
}

// Crushes the frame data by 1 unit.
function getMorphedFrame(data) {
  
  var firstInLine, lastInLine = null;
  var found = false;
  for( var i = 0; i < data.length; i++) {
    
    var line = data[i];
    firstInLine = line.search(/\S/);
    if( firstInLine === -1) {
      firstInLine = null;
    }
    
    for( var j = 0; j < line.length; j++) {
      if( line[j] != ' ') {
        lastInLine = j;
      }
    }
    
    if( firstInLine !== null && lastInLine !== null) {
      data = crushLine(data, i, firstInLine, lastInLine)
      found = true;
    }

    firstInLine = null, lastInLine = null;
  }
  
  if( found ) {
    return data;
  } else {
    return false;
  }
}

function crushLine(data, line, start, end) {
  
  var centers = {
    x: Math.floor(canvasDimensions.x / 2),
    y: Math.floor(canvasDimensions.y / 2)
  }
  
  var crushDirection = 1;
  if( line > centers.y ) {
    crushDirection = -1;
  }
  
  var charA = data[line][start];
  var charB = data[line][end];
  
  data[line] = replaceAt(data[line], start, " ");
  data[line] = replaceAt(data[line], end, " ");

  if( !((end - 1) == (start + 1)) && !(start === end) && !((start + 1) === end)) {
    data[line + crushDirection] = replaceAt(data[line + crushDirection], (start + 1), '+*/\\'.substr(Math.floor(Math.random()*'+*/\\'.length), 1));
    data[line + crushDirection] = replaceAt(data[line + crushDirection], (end - 1), '+*/\\'.substr(Math.floor(Math.random()*'+*/\\'.length), 1));
  } else if ((((start === end) || (start + 1) === end)) && ((line + 1) !== centers.y && (line - 1) !== centers.y && line !== centers.y)) {
    data[line + crushDirection] = replaceAt(data[line + crushDirection], (start), '+*/\\'.substr(Math.floor(Math.random()*'+*/\\'.length), 1));
    data[line + crushDirection] = replaceAt(data[line + crushDirection], (end), '+*/\\'.substr(Math.floor(Math.random()*'+*/\\'.length), 1));
  }
  
  return data;
}

function render(data) {
  var ourData = squareOutData(data.slice());
  renderSquareData(ourData);
}

function renderSquareData(data) {
  element.innerHTML = '';
  for( var i = 0; i < data.length; i++ ) {
    element.innerHTML = element.innerHTML + data[i] + '\n';
  }
  
  renderedData = data;
}

// Morph between whatever is current, to the new frame
function morph(data) {
  
  clearTimeout(myTimeout);
  var frameData = prepareFrames(data.slice());
  animateFrames(frameData);
}

function prepareFrames(data) {
  
  var deconstructionFrames = [];
  var constructionFrames = [];

  var clonedData = renderedData
  
  // If its taking more than 100 frames, its probably somehow broken
  // Get the deconscrution frames
  for(var i = 0; i < 100; i++) {
    var newData = getMorphedFrame(clonedData);
    if( newData === false) {
      break;
    }
    deconstructionFrames.push(newData.slice(0)); 
    clonedData = newData;
  }
  
  // Get the constuction frames for the new data
  var squareData = squareOutData(data);
  constructionFrames.unshift(squareData.slice(0));
  for( var i = 0; i < 100; i++ ) {
    var newData = getMorphedFrame(squareData);
    if( newData === false) {
      break;
    }
    constructionFrames.unshift(newData.slice(0));
    squareData = newData;
  }
  
  return deconstructionFrames.concat(constructionFrames)
}

function animateFrames(frameData) {
  framesToAnimate = frameData;
  animateFrame();
}

function animateFrame() {
  myTimeout = setTimeout(function() {
    
    renderSquareData(framesToAnimate[0]);
    framesToAnimate.shift();
    if( framesToAnimate.length > 0 ) {
      animateFrame();
    }
  }, 20)

  // framesToAnimate
}

function main(element, canvasSize) {
  
  if( !element || !canvasSize ) {
    console.log("sorry, I need an element and a canvas size");
    return;   
  }
  
  init(element, canvasSize);
}

return extend(main, {
  render: render,
  morph: morph
});

})();

var element = document.querySelector('pre');
AsciiMorph(element, {x: 51,y: 28});

var asciis = [
[ "/*   ____ ___  ______   __ __   _____ _   _ _   _   _      _     ___  */",
"/*  / ___/ _ \|  _ \ \ / / \ \ / /_ _| | | | | | | / \    | |   |_ _| */",
"/* | |  | | | | |_) \ V /   \ V / | || |_| | | | |/ _ \   | |    | |  */",
"/* | |__| |_| |  _ < | |     | |  | ||  _  | |_| / ___ \  | |___ | |  */",
"/*  \____\___/|_| \_\|_|     |_| |___|_| |_|\___/_/   \_\ |_____|___| */"],

["++++++++++++++++++++*%%%%%%%%%%%%%%%%%%%%#########",
"++++++++++*#*+**#%%%**********%%%%%%%%%%%%########",
"+++++++++++++##%%********+******%%%%%%%%%%%#######",
"++++++#*++*#*%#**+***+**+****#%%%%%%%%%%%%%%%%%%##",
"+++++++#%*##********+****#%%%%%%%%%%%%%%%%%%%%%%##",
"++*++***%#*****+***+**#**%%%%%%%%%%%%%%%%%%%%%%%%#",
"+++++++++#%%#***%#*********###%%%%%%%%%%%%%%%%%%%#",
"***++***%%%%#*#%%#*******#%%%%%%%%%%%%%%%%%%%%%%%#",
"+*+++**#%%%%#%%%%#*+**+*%%%%%*===+%%%%%%%%%%%%%%%#",
"***+***#%%%%%%%%%*****#%%%+========%%%%%%%%%%%%%%#",
"*******#%%%%%%%%%****%%%*===========#%%%%%%%%%%%%#",
"*******##%%%%%%%%**#%%#==#%%%*+=====#%%%%%%%%%%%##",
"*******##%%%%%%%%%%%%===*####%%%%%##%%@@@#+==++###",
"****#**##%@###%%%%%%@@@@@%%%%%%%%%@@@@%%==+*==+###",
"***###*#%%%+==*%%#*+@+==%====%%*#%@=#%%%=+*+==+###",
"**###**####@=**#++==@+==%====++=++@=#%%%=+**==+###",
"#*####*####%%***++++@===#%===+++*@%=##*=======+###",
"***##**######**===========================+#######",
"###############==========================#%%######",
"***#############=====+===++===========+#%%%%%#####",
"################*===================##++####==*###",
"################*+###+==========*##**++++========*",
"##############===*#+==+########**+==+++++=========",
"##############==++*=====+++##*+=====+++++=========",
"##############==**======+++++=====+++++++=======+=",
"############=*=====+====++++==@@@@@++++++======+==",
"##########*=======+++=========+%@@+===========+==="],


[" _     _____     _______  __        _______ ____  _ ",
"| |   |_ _\ \   / / ____| \ \      / / ____| __ )| |",
"| |    | | \ \ / /|  _|    \ \ /\ / /|  _| |  _ \| |",
"| |___ | |  \ V / | |___    \ V  V / | |___| |_) |_|",
"|_____|___|  \_/  |_____|    \_/\_/  |_____|____/(_)"],
];

AsciiMorph.render(asciis[0]);

var currentIndex = 2;

setTimeout(function() {
AsciiMorph.morph(asciis[1]);
}, 1000);

setInterval(function() {
AsciiMorph.morph(asciis[currentIndex]);
currentIndex++;
currentIndex%= asciis.length;
}, 3000);


function createMarquee() {
var userInput = document.getElementById('messageInput').value;
var marqueeContainer = document.getElementById('marqueeContainer');

// 创建 marquee 元素
var marquee = document.createElement('marquee');
marquee.textContent = userInput;

// 可以在这里添加更多的 marquee 属性，比如滚动速度、方向等
marquee.style.position = 'absolute';
marquee.style.top = Math.random() * window.innerHeight + 'px';
marquee.style.left = Math.random() * window.innerWidth + 'px';

// 将 marquee 元素添加到页面中
marqueeContainer.appendChild(marquee);
}
function createMarquee_para(messageInput) {
var userInput = messageInput;
var marqueeContainer = document.getElementById('marqueeContainer');

// 创建 marquee 元素
var marquee = document.createElement('marquee');
marquee.textContent = userInput;

// 可以在这里添加更多的 marquee 属性，比如滚动速度、方向等
marquee.style.position = 'absolute';
marquee.style.top = Math.random() * window.innerHeight + 'px';
marquee.style.left = Math.random() * window.innerWidth + 'px';

// 将 marquee 元素添加到页面中
marqueeContainer.appendChild(marquee);
}

        </script>
        <div id = "chatdiv">
                
        </div>
        <div id="marqueeContainer"></div>
    </body>
</html>